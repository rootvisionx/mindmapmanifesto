<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Hypnosis Guide | Nazar Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            850: '#151F32',
                            950: '#020617',
                        },
                        emerald: {
                            450: '#10b981', // Custom emerald shade
                        }
                    },
                    animation: {
                        'breathe': 'breathe 8s ease-in-out infinite',
                        'float': 'float 6s ease-in-out infinite',
                        // Utility class (optional, but good practice since you use the keyframe)
                        'fade-in': 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        // --- FIXED: Added missing fadeIn keyframe ---
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        // --------------------------------------------
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.5' },
                            '50%': { transform: 'scale(1.5)', opacity: '1' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>window.react = window.React;</script>
    <script src="https://unpkg.com/lucide-react@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .font-serif {
            font-family: 'Merriweather', serif;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(51, 65, 85, 0.5);
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-200 min-h-screen selection:bg-emerald-500/30">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const {
            Brain, Wind, ArrowDown, Play, Pause, RotateCcw,
            CheckCircle, XCircle, ArrowLeft, ArrowRight, BookOpen,
            Hand, Info, ChevronRight, Activity, Smile, LayoutGrid
        } = LucideReact;

        // --- Data ---
        const RULES = [
            { id: 1, text: "Every thought creates a blueprint that your mind and body work to make real." },
            { id: 2, text: "Imagination is more powerful than knowledge when dealing with your own mind." },
            { id: 3, text: "Your mind learns by repetition." },
            { id: 4, text: "The greater the conscious effort, the less the subconscious responds." },
            { id: 5, text: "Your mind does not care if what you tell it is good or bad, it simply lets it in." }
        ];

        const STEPS = [
            { id: 'induction', title: 'The Induction', duration: 15, icon: Wind, instruction: "Look up. Breathe in deeply." },
            { id: 'deepener', title: 'The Deepener', duration: 20, icon: ArrowDown, instruction: "Drop your chin. Step down 10 to 1." },
            { id: 'anchor', title: 'The Anchor', duration: 10, icon: Hand, instruction: "Imagine a string pulling your finger." },
            { id: 'implantation', title: 'Implantation', duration: 30, icon: Brain, instruction: "Absorb your suggestions." },
            { id: 'awakening', title: 'The Awakening', duration: 5, icon: Activity, instruction: "Count 1 to 5. Wide awake." }
        ];

        // --- Components ---

        const Nav = ({ activeTab, setTab }) => (
            <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 glass-panel rounded-full p-2 flex gap-1 shadow-2xl z-50">
                {[
                    { id: 'prep', icon: BookOpen, label: 'Preparation' },
                    { id: 'learn', icon: Brain, label: 'Learning' },
                    { id: 'session', icon: Play, label: 'Session' },
                ].map(item => (
                    <button
                        key={item.id}
                        onClick={() => setTab(item.id)}
                        className={`px-4 py-2 rounded-full flex items-center gap-2 transition-all ${activeTab === item.id
                            ? 'bg-emerald-600 text-white shadow-[0_0_20px_rgba(16,185,129,0.4)]'
                            : 'text-slate-400 hover:text-white hover:bg-slate-800'
                            }`}
                    >
                        <item.icon className="w-4 h-4" />
                        <span className="text-sm font-medium">{item.label}</span>
                    </button>
                ))}
            </nav>
        );

        const PrepPhase = ({ data, updateData, setTab }) => (
            <div className="max-w-3xl mx-auto p-6 space-y-12 pb-32 animate-[fadeIn_0.5s_ease-out]">
                <div className="text-center space-y-4 pt-10">
                    <h1 className="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-teal-400 pb-2">
                        Self-Hypnosis Protocol
                    </h1>
                    <p className="text-slate-400 text-lg">Define your intent before entering the state.</p>
                </div>

                <div className="glass-panel rounded-2xl p-8 space-y-6">
                    <h2 className="text-2xl font-semibold text-white flex items-center gap-3">
                        <Activity className="text-emerald-400" /> Current State
                    </h2>
                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="space-y-2">
                            <label className="text-sm text-slate-400 uppercase tracking-wider font-bold">The Challenge</label>
                            <textarea
                                className="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all outline-none resize-none h-32"
                                placeholder="What is the main issue? (e.g., Anxiety about public speaking)"
                                value={data.challenge}
                                onChange={e => updateData({ ...data, challenge: e.target.value })}
                            />
                        </div>
                        <div className="space-y-2">
                            <label className="text-sm text-slate-400 uppercase tracking-wider font-bold">Desired Feeling</label>
                            <textarea
                                className="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all outline-none resize-none h-32"
                                placeholder="How do you want to feel instead? (e.g., Calm, powerful, excited)"
                                value={data.desiredFeeling}
                                onChange={e => updateData({ ...data, desiredFeeling: e.target.value })}
                            />
                        </div>
                    </div>
                </div>

                <div className="glass-panel rounded-2xl p-8 space-y-6">
                    <div className="flex justify-between items-start">
                        <h2 className="text-2xl font-semibold text-white flex items-center gap-3">
                            <Brain className="text-emerald-400" /> Suggestion Builder
                        </h2>
                        <button onClick={() => window.open('rules_of_mind.html', '_blank')} className="text-xs text-emerald-400 hover:text-emerald-300 underline">
                            View Rules of Mind
                        </button>
                    </div>

                    <div className="grid md:grid-cols-2 gap-4 text-sm mb-4">
                        <div className="bg-emerald-500/10 border border-emerald-500/20 p-4 rounded-lg">
                            <span className="flex items-center gap-2 text-emerald-400 font-bold mb-2"><CheckCircle className="w-4 h-4" /> DO</span>
                            <ul className="list-disc pl-4 space-y-1 text-slate-300">
                                <li>Present Tense ("I am...")</li>
                                <li>Exciting Words ("Thrilled", "Phenomenal")</li>
                                <li>Positive Action ("I am confident")</li>
                            </ul>
                        </div>
                        <div className="bg-red-500/10 border border-red-500/20 p-4 rounded-lg">
                            <span className="flex items-center gap-2 text-red-400 font-bold mb-2"><XCircle className="w-4 h-4" /> DON'T</span>
                            <ul className="list-disc pl-4 space-y-1 text-slate-300">
                                <li>Future Tense ("I will be...")</li>
                                <li>Negatives ("I am not anxious")</li>
                                <li>Vague Words ("I am okay")</li>
                            </ul>
                        </div>
                    </div>

                    <div className="space-y-4">
                        {[0, 1, 2].map(i => (
                            <div key={i} className="flex gap-4 items-center">
                                <span className="font-mono text-emerald-500/50 text-xl font-bold">0{i + 1}</span>
                                <input
                                    type="text"
                                    className="flex-1 bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-white focus:border-emerald-500 outline-none"
                                    placeholder={`Suggestion #${i + 1} (e.g., I am completely calm and in control)`}
                                    value={data.suggestions[i] || ''}
                                    onChange={e => {
                                        const newSuggestions = [...data.suggestions];
                                        newSuggestions[i] = e.target.value;
                                        updateData({ ...data, suggestions: newSuggestions });
                                    }}
                                />
                            </div>
                        ))}
                    </div>
                </div>

                <div className="flex justify-center">
                    <button
                        onClick={() => setTab('session')}
                        className="bg-emerald-600 hover:bg-emerald-500 text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg shadow-emerald-900/20 flex items-center gap-3 transition-all transform hover:scale-105"
                    >
                        Ready for Session <ArrowRight className="w-5 h-5" />
                    </button>
                </div>
            </div>
        );

        const LearningHub = () => (
            <div className="max-w-4xl mx-auto p-6 space-y-12 pb-32 animate-[fadeIn_0.5s_ease-out]">
                <div className="text-center space-y-4 pt-10">
                    <h1 className="text-4xl font-bold text-white">The Rules of Engagement</h1>
                    <p className="text-slate-400">Understanding how to speak to your operating system.</p>
                </div>

                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {RULES.map(rule => (
                        <div key={rule.id} className="glass-panel p-6 rounded-xl hover:bg-slate-800/50 transition-colors">
                            <div className="text-emerald-500 font-mono font-bold text-lg mb-3">RULE #{rule.id}</div>
                            <p className="text-slate-300 leading-relaxed">{rule.text}</p>
                        </div>
                    ))}
                    <div className="glass-panel p-6 rounded-xl border-emerald-500/30 bg-emerald-900/5">
                        <div className="text-emerald-400 font-mono font-bold text-lg mb-3 flex items-center gap-2">
                            <Hand className="w-5 h-5" /> IDEOMOTOR
                        </div>
                        <p className="text-slate-300 text-sm mb-4">
                            Your subconscious creates tiny muscle movements.
                        </p>
                        <div className="space-y-2 text-sm">
                            <div className="flex justify-between items-center p-2 bg-slate-900/50 rounded">
                                <span>Right Finger Logic</span>
                                <span className="text-emerald-400 font-bold">YES</span>
                            </div>
                            <div className="flex justify-between items-center p-2 bg-slate-900/50 rounded">
                                <span>Left Finger Logic</span>
                                <span className="text-red-400 font-bold">NO</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const SessionMode = ({ data }) => {
            const [isActive, setIsActive] = useState(false);
            const [currentStep, setCurrentStep] = useState(0);
            const [timeLeft, setTimeLeft] = useState(STEPS[0].duration);
            const [counter, setCounter] = useState(10); // For deepener/awakening

            useEffect(() => {
                let interval;
                if (isActive) {
                    interval = setInterval(() => {
                        setTimeLeft(t => {
                            if (t <= 1) {
                                // Next step logic
                                if (currentStep < STEPS.length - 1) {
                                    const nextStep = currentStep + 1;
                                    setCurrentStep(nextStep);

                                    // Reset specific counters
                                    if (STEPS[nextStep].id === 'deepener') setCounter(10);
                                    if (STEPS[nextStep].id === 'awakening') setCounter(1);

                                    return STEPS[nextStep].duration;
                                } else {
                                    setIsActive(false); // End session
                                    return 0;
                                }
                            }

                            // --- FIXED: Optimized counter logic to remove dependency loop ---
                            // Deepener Logic (Countdown 10 -> 1)
                            if (STEPS[currentStep].id === 'deepener' && t % 2 === 0) {
                                setCounter(c => c > 1 ? c - 1 : c);
                            }
                            // Awakening Logic (Countup 1 -> 5)
                            if (STEPS[currentStep].id === 'awakening') {
                                setCounter(c => c < 5 ? c + 1 : c);
                            }
                            // -----------------------------------------------------------------

                            return t - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isActive, currentStep]); // Removed 'counter' dependency

            const startSession = () => {
                setIsActive(true);
                setCurrentStep(0);
                setTimeLeft(STEPS[0].duration);
            };

            const activeStepData = STEPS[currentStep];

            if (!isActive) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center p-6 space-y-8 animate-[fadeIn_0.5s_ease-out]">
                        <div className="relative">
                            <div className="absolute inset-0 bg-emerald-500 rounded-full blur-[100px] opacity-20"></div>
                            <button
                                onClick={startSession}
                                className="group relative bg-slate-900 border-2 border-emerald-500/50 rounded-full w-48 h-48 flex items-center justify-center hover:scale-105 transition-all duration-500 shadow-2xl shadow-emerald-900/30"
                            >
                                <Play className="w-16 h-16 text-emerald-400 ml-2 group-hover:text-white transition-colors" />
                            </button>
                        </div>
                        <h2 className="text-3xl font-bold text-white tracking-tight">Begin Session</h2>
                        <p className="text-slate-400 max-w-sm text-center">
                            Ensure you are in a quiet place. Sit comfortably with your hands on your lap.
                        </p>
                    </div>
                );
            }

            return (
                <div className="h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
                    {/* Background Ambience */}
                    <div className="absolute inset-0 bg-gradient-to-b from-slate-900 to-slate-950 -z-20"></div>
                    <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-emerald-900/10 via-slate-950 to-slate-950 -z-10 animate-pulse"></div>

                    {/* Progress Bar */}
                    <div className="absolute top-0 left-0 w-full h-1 bg-slate-900">
                        <div
                            className="h-full bg-emerald-500 transition-all duration-1000"
                            style={{ width: `${((currentStep) / STEPS.length) * 100}%` }}
                        ></div>
                    </div>

                    <div className="text-center space-y-12 max-w-2xl w-full z-10">
                        <div className="space-y-4">
                            <div className="inline-flex items-center gap-2 px-4 py-1 rounded-full bg-slate-800/50 border border-slate-700 text-slate-400 text-sm font-medium uppercase tracking-widest">
                                <activeStepData.icon className="w-4 h-4" />
                                {activeStepData.title}
                            </div>

                            {/* Visualizers */}
                            {activeStepData.id === 'induction' && (
                                <div className="w-32 h-32 mx-auto rounded-full bg-emerald-400/20 animate-breathe flex items-center justify-center">
                                    <div className="w-16 h-16 rounded-full bg-emerald-400/40"></div>
                                </div>
                            )}

                            {activeStepData.id === 'deepener' && (
                                <div className="text-[120px] font-bold text-slate-800 leading-none select-none transition-all duration-300 font-mono">
                                    {counter}
                                </div>
                            )}

                            {activeStepData.id === 'awakening' && (
                                <div className="text-[120px] font-bold text-emerald-400 leading-none select-none transition-all duration-300 font-mono">
                                    {counter}
                                </div>
                            )}
                        </div>

                        {/* Instructions */}
                        <h2 className="text-3xl md:text-5xl font-serif text-white leading-tight animate-[float_4s_ease-in-out_infinite]">
                            {activeStepData.id === 'implantation'
                                ? (data.suggestions[0] || "I am calm and confident.")
                                : activeStepData.instruction}
                        </h2>

                        {/* Implantation Rotator */}
                        {activeStepData.id === 'implantation' && data.suggestions.length > 1 && (
                            <div className="space-y-4 pt-8 border-t border-slate-800/50">
                                {data.suggestions.slice(1).map((s, i) => (
                                    <p key={i} className="text-xl text-slate-500 font-serif italic">"{s}"</p>
                                ))}
                            </div>
                        )}

                        <div className="absolute bottom-12 left-0 w-full text-center">
                            <button
                                onClick={() => setIsActive(false)}
                                className="text-slate-600 hover:text-white transition-colors text-sm uppercase tracking-widest"
                            >
                                End Session
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const NavigationButtons = () => (
            <div className="fixed top-6 left-6 z-50 flex gap-2 hidden md:flex">
                <button onClick={() => window.history.back()} className="p-2 rounded-full bg-slate-900 border border-slate-700 text-slate-400 hover:text-white hover:border-slate-500 transition-all" title="Go Back">
                    <ArrowLeft className="w-5 h-5" />
                </button>
                <a href="nazar_hub.html" className="p-2 rounded-full bg-slate-900 border border-slate-700 text-slate-400 hover:text-white hover:border-slate-500 transition-all" title="Back to Hub">
                    <LayoutGrid className="w-5 h-5" />
                </a>
            </div>
        );

        const App = () => {
            const [activeTab, setTab] = useState('prep');
            const [data, setData] = useState({
                challenge: '',
                desiredFeeling: '',
                suggestions: ['', '', '']
            });

            return (
                <div className="relative">
                    <NavigationButtons />
                    {activeTab === 'prep' && <PrepPhase data={data} updateData={setData} setTab={setTab} />}
                    {activeTab === 'learn' && <LearningHub />}
                    {activeTab === 'session' && <SessionMode data={data} />}

                    {activeTab !== 'session' && <Nav activeTab={activeTab} setTab={setTab} />}
                    {/* Hide nav in session mode to reduce distractions */}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>